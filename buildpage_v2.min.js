!function(e){"use strict";const t=$("#form-body"),n=$("#data-body"),a=$("#page-alerts");let o,i;const l=function(){return Math.random().toString().replace(/0\./,"")},s=function(e){$('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error: </strong> '+e.message+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>').appendTo(a),console.error(e)},c=function(e,t,n){let a={};return function(o){n||(n="Don't call this twice without a uniqueId",console.warn(n)),a[n]&&clearTimeout(a[n]),a[n]=setTimeout(()=>e(o),t)}},d=function(e){const t=l();return e=e||{},e.edit=e.edit||!1,e.edit_func=e.edit_func||console.log,e.short=e.short||!1,e.short_title=e.short_title||"",function(n){e.edit&&(n.entry_name.match(/PDX\ Passage\ Info/)&&!o.passages.write&&(e.edit=!1),n.entry_name.match(/PDX\ Passage\ Info/)||o.other.write||(e.edit=!1)),n.pdx_id=n.pdx_id||"N/A",n.entry_name=n.entry_name||"N/A",n.description=n.description||"N/A",n.entry_metadata=n.entry_metadata||{},n.entry_metadata.user=n.entry_metadata.user||"N/A",n.entry_data=n.entry_data||[];const a=$("<div>"),i=$("<ul>",{class:"list-group"});return e.short?a.append($("<p>",{class:"lead",text:n.pdx_id+": "+e.short_title})):(a.append($("<p>",{class:"h5",text:n.pdx_id+": "+n.entry_name})),a.append($("<p>",{class:"font-weight-light text-muted",html:n.description+"<br />-"+n.entry_metadata.user}))),i.appendTo(a),n.entry_data.forEach(function(a,o){const s=$("<li>",{class:"list-group-item"}),d=l();e.edit?s.append($("<div>",{class:"form-group row"}).append($("<label>",{text:a.key,for:"list-item-"+d,class:"col-sm-3 col-form-label"})).append($("<div>",{class:"col-sm-9"}).append($("<input>",{class:"form-control",id:"list-item-"+d,value:a.value}).on("keyup",c(function(t){e.edit_func({id:n._id,key:"entry_data."+o,value:t.target.value,origin:a.value})},500,t))))):s.append($("<strong>",{html:a.key})).append($("<span>&emsp;"+a.value+"</span>")),i.append(s)}),a}},r=function(e,t,n){const a=l(),o=$("<div>",{class:"card"});o.append(function(e,t,n){const a=n>1?" entries)":" entry)";return $("<div>",{class:"card-header",id:"header-"+t}).append($("<h2>",{class:"mb-0"}).append($("<button>",{class:"btn btn-link collapsed",type:"button","data-toggle":"collapse","data-target":"#collapse-"+t,"aria-expanded":"false","aria-controls":"collapse-"+t,html:e+" ("+n+a})))}(t,a,e.length));return function(e,t){let n,a;return n=$("<div>",{id:"collapse-"+e,class:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionHolder"}),a=$("<div>",{class:"card-body"}).append(t),n.append(a),n}(a,e.map(function(e){return n.build(e,function(e){return d()(e)})})).appendTo(o),o},p=function(e){return d({short:!0,short_title:"Circle: "+e.circle})({pdx_id:e.name,entry_data:[{key:"*note",value:"This is a dummy node, it will only update after editing its child node and refreshing the timeline display."},{key:"New Exp#",value:e.name}]})};i=function(){const e=function(){let e,t,n,a,o=l(),i={};return $("#page-body").append($('<div class="modal fade" id="modal'+o+'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="title'+o+'"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="body'+o+'"></div><div class="modal-footer" id="foot'+o+'"></div></div></div></div>')),a=$("#modal"+o),e=$("#title"+o),t=$("#body"+o),n=$("#foot"+o),i.title=function(t){e.empty(),e.append(t)},i.body=function(e){t.empty(),t.append(e)},i.foot=function(e){n.empty(),n.append(e)},i.show=function(){a.modal("show")},i.hide=function(){a.modal("hide")},i}();return i=function(){return e},e};const u=function(t,a){return function(c){t.clearUpdates(),n.empty();const u=a(c),m=t.expandIDs(u);console.log("search results?",u),m.list("pdx_id").forEach(function(a){const c=m.expandIDs(m.filter(function(e){return e.pdx_id===a}));$("<p>",{class:"h3 row",text:"PDX ID: "+a}).appendTo(n);const u={nanostring:c.filter(e=>e.entry_name.match(/^PDX_ID\ to\ Nanostring\ naming\ and\ model\ information$/i)),omics:c.filter(e=>e.entry_name.match(/^PDX_ID\ to\ old\ PDX_ID_OldKinomic\/Affy\/Illumina\ ID\'s$/i))};(u.nanostring.length||u.omics.length)&&($("<p>",{class:"h4 row",text:"Avaliable Data"}).appendTo(n),function(e,t){const n=$("<p>",{class:"row"});return e.nanostring.forEach(function(e){t.build(e,function(e){let t={};return e.entry_data.forEach(function(e){t[e.key]=e.value}),$("<div>").append($("<dt>",{class:"col-sm-3",text:"NanoString"})).append($("<dd>",{class:"col-sm-9",text:t.Model+" ("+t["Comment 1"]+"): "+t.Nsname_model+" ("+t["Class Name"]+")"})).children()}).appendTo(n)}),e.omics.forEach(function(e){t.build(e,function(e){let t={};const n=$("<div>");return e.entry_data.forEach(function(e){t[e.key]=e.value}),n.append($("<dt>",{class:"col-sm-3",text:"Kinomics"})).append($("<dd>",{class:"col-sm-9",html:"<a href=http://toolbox.kinomecore.com/?data="+encodeURIComponent('*[http://db.kinomecore.com/1.0.0/lvl_1.1.2?find={"sample_data":{"$elemMatch":{"value":"'+t["Kinomics_Sample name ()"]+'"}}}]*')+">"+t["Kinomics_Sample name ()"]+"</a>"})),n.append($("<dt>",{class:"col-sm-3",text:"Affymetrix"})).append($("<dd>",{class:"col-sm-9",text:t["Affy_Sample ID"]})),n.append($("<dt>",{class:"col-sm-3",text:"Illumina"})).append($("<dd>",{class:"col-sm-9",html:t.Illumina_ID+"("+t.Illumina_SentrixPosition+")"})),n.children()}).appendTo(n)}),n}(u,t).appendTo(n));const f=c.filter(e=>e.entry_name.match(/PDX\ Passage\ Info/i));if(f.length){console.log(f);let a="figure-"+l();$("<p>",{class:"h4 row",text:"Passage Timeline"}).appendTo(n);let c=$("<div>",{class:"col-12"}),r=$("<div>",{class:"col-12"}),u=$("<div>",{id:a,class:"chart"}),m={};r.append(u),$("<p>",{class:"row"}).append(r).append(c).appendTo(n),t.build(f,function(n){u.empty();let l=function(e,t,n){return function(a){n.name=a.name,t.hide(),t.empty();let l=$("<div>",{class:"row"}).appendTo(t),c=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Prior"})),r=$("<div>",{class:"chart-data col-md-4 col-sm-12"}).appendTo(l).append($("<p>",{class:"text-center h4",text:"Selected"})),u=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Next"}));a.prior.forEach(function(t){t.id?c.append(e.build(t.id,d({short:!0,short_title:"Circle: "+t.circle}))):c.append(p(t))}),a.self.forEach(function(t){if(t.id){if(o.passages.write){const n=$("<button>",{class:"btn btn-primary",text:"Update",click:function(n){n.preventDefault(),function(e,t){let n={},a={};const o=i();o.title($("<h4>",{text:"Edit Entry"})),o.body(t.build(e,d({edit:!0,edit_func:function(e){n[e.id]=n[e.id]||{},n[e.id][e.key]=e}}),a)),a.clear(),o.foot($("<button>",{class:"btn btn-primary",text:"Submit",click:function(e){e.preventDefault(),t.set(Object.keys(n).map(e=>Object.keys(n[e]).map(t=>n[e][t])).flat().filter(e=>e.value!==e.origin)).then(function(e){return new Promise(function(t){setTimeout(t,e)})}(750)).catch(s).then(o.hide)}})),o.show()}(t.id,e)}});r.append($("<p>",{class:"text-center"}).append(n))}r.append(e.build(t.id,d({short:!0,short_title:"Circle: "+t.circle})))}else r.append(p(t))}),a.next.forEach(function(t){t.id?u.append(e.build(t.id,d({short:!0,short_title:"Circle: "+t.circle}))):u.append(p(t))}),t.show()}}(t,c,m);const r=e.createPassageFigure(n,l,m);return m.name&&(m.state&&m.state.name?l(m.state):c.hide()),loadchart(a,r.figure),u})}n.append($("<p>",{class:"h4 row",text:"All Descriptive Data"}));const h=$("<div>",{class:"accordion",id:"accordionHolder"}).appendTo($("<p>",{class:"row"}).appendTo(n));c.list("entry_name").forEach(function(e){r(c.filter(function(t){return t.entry_name===e}),e,t).appendTo(h)})})}};e.build_page=function(){const n=function(e,t){let n,a;return n=1*e.replace(/[^0-9]+/gi,""),a=1*t.replace(/[^0-9]+/gi,""),n&&a&&n>2&&a>2&&n-a!=0?n-a:e>t?1:t>e?-1:0},a=function(e){return function(t){const n=JSON.parse(t);return e.filter(function(e){return e&&e[n.key]&&e[n.key]===n.value})}},i=function(){let e={};return function(t){if(t=t.toString(),e[t])throw"Cannot call make_selectors with the same key multiple times";return e[t]={select:function(n){return e[t].select=function(a){Object.keys(e).forEach(function(n){n!==t&&e[n].unselect()}),n(a.target.value)},e[t].select},unselect:function(n){return e[t].unselect=n,e[t].unselect}},e[t]}}();return function(s,d){o=d;const r=e.expandData(s),p=[{data:r.list("pdx_id"),key:"pdx_id",label:"PDX ID",width:3,selector:i("0"),change:u(r,a(r))},{data:r.list("origin_id"),key:"origin_id",label:"Origin ID",width:3,selector:i("1"),change:u(r,a(r))}],m=$("<div>",{class:"row",id:"form-body"}).appendTo($("<div>",{class:"col-12"}).appendTo($("<div>",{class:"row"})).appendTo(t));return p.forEach(function(e){m.append(function(e){const t=l();let a=$("<div>",{class:"from-group col-"+e.width}).append($("<label>",{for:"select-header-"+t,text:e.label})),o=$("<select>",{class:"form-control",id:"select-header-"+t}),i=$("<option>",{disabled:"disabled",selected:"selected",text:"Select One"});return o.append(i),e.data.sort(n).forEach(function(t){o.append($("<option>",{value:JSON.stringify({key:e.key,value:t}),text:t}))}),a.append(o),o.change(e.selector.select(e.change)),e.selector.unselect(function(){i[0].selected=!0}),a}(e))}),function(e){const t=l(),n=e.selector.select(e.change);let a=$("<div>",{class:"form-group col-"+e.width}).append($("<label>",{for:"search-bar-"+t,text:e.label})),o=$("<input>",{class:"form-control",type:"text",id:"search-bar-"+t}),i="";return a.append(o),o.on("keyup",c(function(e){i!==e.target.value&&(n(e),i=e.target.value)},500,"search-"+t)),e.selector.unselect(function(){o.val("")}),a}({selector:i("2"),label:"Exact Word Search",width:6,change:u(r,function(e){return function(t){return e.search(t)}}(r))}).appendTo(m),p}}()}(DATA_DISPLAY);