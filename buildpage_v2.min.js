!function(e){"use strict";const t=$("#form-body"),n=$("#data-body");let a;const o=function(){return Math.random().toString().replace(/0\./,"")},l=function(e,t,n){let a={};return function(o){n||(n="Don't call this twice without a uniqueId",console.warn(n)),a[n]&&clearTimeout(a[n]),a[n]=setTimeout(()=>e(o),t)}},i=function(e){const t=o();return e=e||{},e.edit=e.edit||!1,e.edit_func=e.edit_func||console.log,e.short=e.short||!1,e.short_title=e.short_title||"",function(n){n.pdx_id=n.pdx_id||"N/A",n.entry_name=n.entry_name||"N/A",n.description=n.description||"N/A",n.entry_metadata=n.entry_metadata||{},n.entry_metadata.user=n.entry_metadata.user||"N/A",n.entry_data=n.entry_data||[];const a=$("<div>"),i=$("<ul>",{class:"list-group"});return e.short?a.append($("<p>",{class:"lead",text:n.pdx_id+": "+e.short_title})):(a.append($("<p>",{class:"h5",text:n.pdx_id+": "+n.entry_name})),a.append($("<p>",{class:"font-weight-light text-muted",html:n.description+"<br />-"+n.entry_metadata.user}))),i.appendTo(a),n.entry_data.forEach(function(a,c){const d=$("<li>",{class:"list-group-item"}),s=o();e.edit?d.append($("<div>",{class:"form-group row"}).append($("<label>",{text:a.key,for:"list-item-"+s,class:"col-sm-3 col-form-label"})).append($("<div>",{class:"col-sm-9"}).append($("<input>",{class:"form-control",id:"list-item-"+s,value:a.value}).on("keyup",l(function(t){e.edit_func({id:n._id,key:"entry_data."+c,value:t.target.value,origin:a.value})},500,t))))):d.append($("<strong>",{html:a.key})).append($("<span>&emsp;"+a.value+"</span>")),i.append(d)}),a}},c=function(e,t,n){const a=o(),l=$("<div>",{class:"card"});l.append(function(e,t,n){const a=n>1?" entries)":" entry)";return $("<div>",{class:"card-header",id:"header-"+t}).append($("<h2>",{class:"mb-0"}).append($("<button>",{class:"btn btn-link collapsed",type:"button","data-toggle":"collapse","data-target":"#collapse-"+t,"aria-expanded":"false","aria-controls":"collapse-"+t,html:e+" ("+n+a})))}(t,a,e.length));return function(e,t){let n,a;return n=$("<div>",{id:"collapse-"+e,class:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionHolder"}),a=$("<div>",{class:"card-body"}).append(t),n.append(a),n}(a,e.map(function(e){return n.build(e,function(e){return i()(e)})})).appendTo(l),l},d=function(e){return i({short:!0,short_title:"Circle: "+e.circle})({pdx_id:e.name,entry_data:[{key:"*note",value:"This is a dummy node, it will only update after editing its child node and refreshing the timeline display."},{key:"New Exp#",value:e.name}]})};a=function(){const e=function(){let e,t,n,a,l=o(),i={};return $("#page-body").append($('<div class="modal fade" id="modal'+l+'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="title'+l+'"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="body'+l+'"></div><div class="modal-footer" id="foot'+l+'"></div></div></div></div>')),a=$("#modal"+l),e=$("#title"+l),t=$("#body"+l),n=$("#foot"+l),i.title=function(t){e.empty(),e.append(t)},i.body=function(e){t.empty(),t.append(e)},i.foot=function(e){n.empty(),n.append(e)},i.show=function(){a.modal("show")},i.hide=function(){a.modal("hide")},i}();return a=function(){return e},e};const s=function(t,l){return function(s){t.clearUpdates(),n.empty();const r=l(s),p=t.expandIDs(r);console.log("search results?",r),p.list("pdx_id").forEach(function(l){const s=p.expandIDs(p.filter(function(e){return e.pdx_id===l}));$("<p>",{class:"h3 row",text:"PDX ID: "+l}).appendTo(n);const r={nanostring:s.filter(e=>e.entry_name.match(/^PDX_ID\ to\ Nanostring\ naming\ and\ model\ information$/i)),omics:s.filter(e=>e.entry_name.match(/^PDX_ID\ to\ old\ PDX_ID_OldKinomic\/Affy\/Illumina\ ID\'s$/i))};(r.nanostring.length||r.omics.length)&&($("<p>",{class:"h4 row",text:"Avaliable Data"}).appendTo(n),function(e,t){const n=$("<p>",{class:"row"});return e.nanostring.forEach(function(e){t.build(e,function(e){let t={};return e.entry_data.forEach(function(e){t[e.key]=e.value}),$("<div>").append($("<dt>",{class:"col-sm-3",text:"NanoString"})).append($("<dd>",{class:"col-sm-9",text:t.Model+" ("+t["Comment 1"]+"): "+t.Nsname_model+" ("+t["Class Name"]+")"})).children()}).appendTo(n)}),e.omics.forEach(function(e){t.build(e,function(e){let t={};const n=$("<div>");return e.entry_data.forEach(function(e){t[e.key]=e.value}),n.append($("<dt>",{class:"col-sm-3",text:"Kinomics"})).append($("<dd>",{class:"col-sm-9",html:"<a href=http://toolbox.kinomecore.com/?data="+encodeURIComponent('*[http://db.kinomecore.com/1.0.0/lvl_1.1.2?find={"sample_data":{"$elemMatch":{"value":"'+t["Kinomics_Sample name ()"]+'"}}}]*')+">"+t["Kinomics_Sample name ()"]+"</a>"})),n.append($("<dt>",{class:"col-sm-3",text:"Affymetrix"})).append($("<dd>",{class:"col-sm-9",text:t["Affy_Sample ID"]})),n.append($("<dt>",{class:"col-sm-3",text:"Illumina"})).append($("<dd>",{class:"col-sm-9",html:t.Illumina_ID+"("+t.Illumina_SentrixPosition+")"})),n.children()}).appendTo(n)}),n}(r,t).appendTo(n));const u=s.filter(e=>e.entry_name.match(/PDX\ Passage\ Info/i));if(u.length){console.log(u);let l="figure-"+o();$("<p>",{class:"h4 row",text:"Passage Timeline"}).appendTo(n);let c=$("<div>",{class:"col-12"}),s=$("<div>",{class:"col-12"}),r=$("<div>",{id:l,class:"chart"}),p={};s.append(r),$("<p>",{class:"row"}).append(s).append(c).appendTo(n),t.build(u,function(n){r.empty();let o=function(e,t,n){return function(o){n.name=o.name,t.hide(),t.empty();let l=$("<div>",{class:"row"}).appendTo(t),c=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Prior"})),s=$("<div>",{class:"chart-data col-md-4 col-sm-12"}).appendTo(l).append($("<p>",{class:"text-center h4",text:"Selected"})),r=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Next"}));o.prior.forEach(function(t){t.id?c.append(e.build(t.id,i({short:!0,short_title:"Circle: "+t.circle}))):c.append(d(t))}),o.self.forEach(function(t){t.id?(s.append($("<p>",{class:"text-center"}).append($("<button>",{class:"btn btn-primary",text:"Update",click:function(n){n.preventDefault(),function(e,t){let n={},o={};const l=a();l.title($("<h4>",{text:"Edit Entry"})),l.body(t.build(e,i({edit:!0,edit_func:function(e){n[e.id]=n[e.id]||{},n[e.id][e.key]=e}}),o)),o.clear(),l.foot($("<button>",{class:"btn btn-primary",text:"Submit",click:function(e){e.preventDefault(),t.set(Object.keys(n).map(e=>Object.keys(n[e]).map(t=>n[e][t])).flat().filter(e=>e.value!==e.origin)).then(function(e){return new Promise(function(t){setTimeout(t,e)})}(750)).catch(console.error).then(l.hide)}})),l.show()}(t.id,e)}}))),s.append(e.build(t.id,i({short:!0,short_title:"Circle: "+t.circle})))):s.append(d(t))}),o.next.forEach(function(t){t.id?r.append(e.build(t.id,i({short:!0,short_title:"Circle: "+t.circle}))):r.append(d(t))}),t.show()}}(t,c,p);const s=e.createPassageFigure(n,o,p);return p.name&&(p.state&&p.state.name?o(p.state):c.hide()),loadchart(l,s.figure),r})}n.append($("<p>",{class:"h4 row",text:"All Descriptive Data"}));const f=$("<div>",{class:"accordion",id:"accordionHolder"}).appendTo($("<p>",{class:"row"}).appendTo(n));s.list("entry_name").forEach(function(e){c(s.filter(function(t){return t.entry_name===e}),e,t).appendTo(f)})})}};e.build_page=function(){const n=function(e,t){let n,a;return n=1*e.replace(/[^0-9]+/gi,""),a=1*t.replace(/[^0-9]+/gi,""),n&&a&&n>2&&a>2&&n-a!=0?n-a:e>t?1:t>e?-1:0},a=function(e){return function(t){const n=JSON.parse(t);return e.filter(function(e){return e&&e[n.key]&&e[n.key]===n.value})}},i=function(){let e={};return function(t){if(t=t.toString(),e[t])throw"Cannot call make_selectors with the same key multiple times";return e[t]={select:function(n){return e[t].select=function(a){Object.keys(e).forEach(function(n){n!==t&&e[n].unselect()}),n(a.target.value)},e[t].select},unselect:function(n){return e[t].unselect=n,e[t].unselect}},e[t]}}();return function(c){const d=e.expandData(c),r=[{data:d.list("pdx_id"),key:"pdx_id",label:"PDX ID",width:3,selector:i("0"),change:s(d,a(d))},{data:d.list("origin_id"),key:"origin_id",label:"Origin ID",width:3,selector:i("1"),change:s(d,a(d))}],p=$("<div>",{class:"row",id:"form-body"}).appendTo($("<div>",{class:"col-12"}).appendTo($("<div>",{class:"row"})).appendTo(t));return r.forEach(function(e){p.append(function(e){const t=o();let a=$("<div>",{class:"from-group col-"+e.width}).append($("<label>",{for:"select-header-"+t,text:e.label})),l=$("<select>",{class:"form-control",id:"select-header-"+t}),i=$("<option>",{disabled:"disabled",selected:"selected",text:"Select One"});return l.append(i),e.data.sort(n).forEach(function(t){l.append($("<option>",{value:JSON.stringify({key:e.key,value:t}),text:t}))}),a.append(l),l.change(e.selector.select(e.change)),e.selector.unselect(function(){i[0].selected=!0}),a}(e))}),function(e){const t=o(),n=e.selector.select(e.change);let a=$("<div>",{class:"form-group col-"+e.width}).append($("<label>",{for:"search-bar-"+t,text:e.label})),i=$("<input>",{class:"form-control",type:"text",id:"search-bar-"+t}),c="";return a.append(i),i.on("keyup",l(function(e){c!==e.target.value&&(n(e),c=e.target.value)},500,"search-"+t)),e.selector.unselect(function(){i.val("")}),a}({selector:i("2"),label:"Exact Word Search",width:6,change:s(d,function(e){return function(t){return e.search(t)}}(d))}).appendTo(p),r}}()}(DATA_DISPLAY);