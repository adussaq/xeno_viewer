!function(e){"use strict";const t=$("#form-body"),n=$("#data-body");let a,o;const i=function(){return Math.random().toString().replace(/0\./,"")},l=function(e,t,n){let a={};return function(o){n||(n="Don't call this twice without a uniqueId",console.warn(n)),a[n]&&clearTimeout(a[n]),a[n]=setTimeout(()=>e(o),t)}},c=function(e){const t=i();return e=e||{},e.edit=e.edit||!1,e.edit_func=e.edit_func||console.log,e.short=e.short||!1,e.short_title=e.short_title||"",function(n){e.edit&&(n.entry_name.match(/PDX\ Passage\ Info/)&&!a.passages.write&&(e.edit=!1),n.entry_name.match(/PDX\ Passage\ Info/)||a.other.write||(e.edit=!1)),n.pdx_id=n.pdx_id||"N/A",n.entry_name=n.entry_name||"N/A",n.description=n.description||"N/A",n.entry_metadata=n.entry_metadata||{},n.entry_metadata.user=n.entry_metadata.user||"N/A",n.entry_data=n.entry_data||[];const o=$("<div>"),c=$("<ul>",{class:"list-group"});return e.short?o.append($("<p>",{class:"lead",text:n.pdx_id+": "+e.short_title})):(o.append($("<p>",{class:"h5",text:n.pdx_id+": "+n.entry_name})),o.append($("<p>",{class:"font-weight-light text-muted",html:n.description+"<br />-"+n.entry_metadata.user}))),c.appendTo(o),n.entry_data.forEach(function(a,o){const d=$("<li>",{class:"list-group-item"}),s=i();e.edit?d.append($("<div>",{class:"form-group row"}).append($("<label>",{text:a.key,for:"list-item-"+s,class:"col-sm-3 col-form-label"})).append($("<div>",{class:"col-sm-9"}).append($("<input>",{class:"form-control",id:"list-item-"+s,value:a.value}).on("keyup",l(function(t){e.edit_func({id:n._id,key:"entry_data."+o,value:t.target.value,origin:a.value})},500,t))))):d.append($("<strong>",{html:a.key})).append($("<span>&emsp;"+a.value+"</span>")),c.append(d)}),o}},d=function(e,t,n){const a=i(),o=$("<div>",{class:"card"});o.append(function(e,t,n){const a=n>1?" entries)":" entry)";return $("<div>",{class:"card-header",id:"header-"+t}).append($("<h2>",{class:"mb-0"}).append($("<button>",{class:"btn btn-link collapsed",type:"button","data-toggle":"collapse","data-target":"#collapse-"+t,"aria-expanded":"false","aria-controls":"collapse-"+t,html:e+" ("+n+a})))}(t,a,e.length));return function(e,t){let n,a;return n=$("<div>",{id:"collapse-"+e,class:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionHolder"}),a=$("<div>",{class:"card-body"}).append(t),n.append(a),n}(a,e.map(function(e){return n.build(e,function(e){return c()(e)})})).appendTo(o),o},s=function(e){return c({short:!0,short_title:"Circle: "+e.circle})({pdx_id:e.name,entry_data:[{key:"*note",value:"This is a dummy node, it will only update after editing its child node and refreshing the timeline display."},{key:"New Exp#",value:e.name}]})};o=function(){const e=function(){let e,t,n,a,o=i(),l={};return $("#page-body").append($('<div class="modal fade" id="modal'+o+'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="title'+o+'"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" id="body'+o+'"></div><div class="modal-footer" id="foot'+o+'"></div></div></div></div>')),a=$("#modal"+o),e=$("#title"+o),t=$("#body"+o),n=$("#foot"+o),l.title=function(t){e.empty(),e.append(t)},l.body=function(e){t.empty(),t.append(e)},l.foot=function(e){n.empty(),n.append(e)},l.show=function(){a.modal("show")},l.hide=function(){a.modal("hide")},l}();return o=function(){return e},e};const r=function(t,l){return function(r){t.clearUpdates(),n.empty();const p=l(r),u=t.expandIDs(p);console.log("search results?",p),u.list("pdx_id").forEach(function(l){const r=u.expandIDs(u.filter(function(e){return e.pdx_id===l}));$("<p>",{class:"h3 row",text:"PDX ID: "+l}).appendTo(n);const p={nanostring:r.filter(e=>e.entry_name.match(/^PDX_ID\ to\ Nanostring\ naming\ and\ model\ information$/i)),omics:r.filter(e=>e.entry_name.match(/^PDX_ID\ to\ old\ PDX_ID_OldKinomic\/Affy\/Illumina\ ID\'s$/i))};(p.nanostring.length||p.omics.length)&&($("<p>",{class:"h4 row",text:"Avaliable Data"}).appendTo(n),function(e,t){const n=$("<p>",{class:"row"});return e.nanostring.forEach(function(e){t.build(e,function(e){let t={};return e.entry_data.forEach(function(e){t[e.key]=e.value}),$("<div>").append($("<dt>",{class:"col-sm-3",text:"NanoString"})).append($("<dd>",{class:"col-sm-9",text:t.Model+" ("+t["Comment 1"]+"): "+t.Nsname_model+" ("+t["Class Name"]+")"})).children()}).appendTo(n)}),e.omics.forEach(function(e){t.build(e,function(e){let t={};const n=$("<div>");return e.entry_data.forEach(function(e){t[e.key]=e.value}),n.append($("<dt>",{class:"col-sm-3",text:"Kinomics"})).append($("<dd>",{class:"col-sm-9",html:"<a href=http://toolbox.kinomecore.com/?data="+encodeURIComponent('*[http://db.kinomecore.com/1.0.0/lvl_1.1.2?find={"sample_data":{"$elemMatch":{"value":"'+t["Kinomics_Sample name ()"]+'"}}}]*')+">"+t["Kinomics_Sample name ()"]+"</a>"})),n.append($("<dt>",{class:"col-sm-3",text:"Affymetrix"})).append($("<dd>",{class:"col-sm-9",text:t["Affy_Sample ID"]})),n.append($("<dt>",{class:"col-sm-3",text:"Illumina"})).append($("<dd>",{class:"col-sm-9",html:t.Illumina_ID+"("+t.Illumina_SentrixPosition+")"})),n.children()}).appendTo(n)}),n}(p,t).appendTo(n));const f=r.filter(e=>e.entry_name.match(/PDX\ Passage\ Info/i));if(f.length){console.log(f);let l="figure-"+i();$("<p>",{class:"h4 row",text:"Passage Timeline"}).appendTo(n);let d=$("<div>",{class:"col-12"}),r=$("<div>",{class:"col-12"}),p=$("<div>",{id:l,class:"chart"}),u={};r.append(p),$("<p>",{class:"row"}).append(r).append(d).appendTo(n),t.build(f,function(n){p.empty();let i=function(e,t,n){return function(i){n.name=i.name,t.hide(),t.empty();let l=$("<div>",{class:"row"}).appendTo(t),d=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Prior"})),r=$("<div>",{class:"chart-data col-md-4 col-sm-12"}).appendTo(l).append($("<p>",{class:"text-center h4",text:"Selected"})),p=$("<div>",{class:"chart-data"}).appendTo($("<div>",{class:"col col-md-4 col-sm-12"}).appendTo(l)).append($("<p>",{class:"text-center h4",text:"Next"}));i.prior.forEach(function(t){t.id?d.append(e.build(t.id,c({short:!0,short_title:"Circle: "+t.circle}))):d.append(s(t))}),i.self.forEach(function(t){if(t.id){if(a.passages.write){const n=$("<button>",{class:"btn btn-primary",text:"Update",click:function(n){n.preventDefault(),function(e,t){let n={},a={};const i=o();i.title($("<h4>",{text:"Edit Entry"})),i.body(t.build(e,c({edit:!0,edit_func:function(e){n[e.id]=n[e.id]||{},n[e.id][e.key]=e}}),a)),a.clear(),i.foot($("<button>",{class:"btn btn-primary",text:"Submit",click:function(e){e.preventDefault(),t.set(Object.keys(n).map(e=>Object.keys(n[e]).map(t=>n[e][t])).flat().filter(e=>e.value!==e.origin)).then(function(e){return new Promise(function(t){setTimeout(t,e)})}(750)).catch(console.error).then(i.hide)}})),i.show()}(t.id,e)}});r.append($("<p>",{class:"text-center"}).append(n))}r.append(e.build(t.id,c({short:!0,short_title:"Circle: "+t.circle})))}else r.append(s(t))}),i.next.forEach(function(t){t.id?p.append(e.build(t.id,c({short:!0,short_title:"Circle: "+t.circle}))):p.append(s(t))}),t.show()}}(t,d,u);const r=e.createPassageFigure(n,i,u);return u.name&&(u.state&&u.state.name?i(u.state):d.hide()),loadchart(l,r.figure),p})}n.append($("<p>",{class:"h4 row",text:"All Descriptive Data"}));const m=$("<div>",{class:"accordion",id:"accordionHolder"}).appendTo($("<p>",{class:"row"}).appendTo(n));r.list("entry_name").forEach(function(e){d(r.filter(function(t){return t.entry_name===e}),e,t).appendTo(m)})})}};e.build_page=function(){const n=function(e,t){let n,a;return n=1*e.replace(/[^0-9]+/gi,""),a=1*t.replace(/[^0-9]+/gi,""),n&&a&&n>2&&a>2&&n-a!=0?n-a:e>t?1:t>e?-1:0},o=function(e){return function(t){const n=JSON.parse(t);return e.filter(function(e){return e&&e[n.key]&&e[n.key]===n.value})}},c=function(){let e={};return function(t){if(t=t.toString(),e[t])throw"Cannot call make_selectors with the same key multiple times";return e[t]={select:function(n){return e[t].select=function(a){Object.keys(e).forEach(function(n){n!==t&&e[n].unselect()}),n(a.target.value)},e[t].select},unselect:function(n){return e[t].unselect=n,e[t].unselect}},e[t]}}();return function(d,s){a=s;const p=e.expandData(d),u=[{data:p.list("pdx_id"),key:"pdx_id",label:"PDX ID",width:3,selector:c("0"),change:r(p,o(p))},{data:p.list("origin_id"),key:"origin_id",label:"Origin ID",width:3,selector:c("1"),change:r(p,o(p))}],f=$("<div>",{class:"row",id:"form-body"}).appendTo($("<div>",{class:"col-12"}).appendTo($("<div>",{class:"row"})).appendTo(t));return u.forEach(function(e){f.append(function(e){const t=i();let a=$("<div>",{class:"from-group col-"+e.width}).append($("<label>",{for:"select-header-"+t,text:e.label})),o=$("<select>",{class:"form-control",id:"select-header-"+t}),l=$("<option>",{disabled:"disabled",selected:"selected",text:"Select One"});return o.append(l),e.data.sort(n).forEach(function(t){o.append($("<option>",{value:JSON.stringify({key:e.key,value:t}),text:t}))}),a.append(o),o.change(e.selector.select(e.change)),e.selector.unselect(function(){l[0].selected=!0}),a}(e))}),function(e){const t=i(),n=e.selector.select(e.change);let a=$("<div>",{class:"form-group col-"+e.width}).append($("<label>",{for:"search-bar-"+t,text:e.label})),o=$("<input>",{class:"form-control",type:"text",id:"search-bar-"+t}),c="";return a.append(o),o.on("keyup",l(function(e){c!==e.target.value&&(n(e),c=e.target.value)},500,"search-"+t)),e.selector.unselect(function(){o.val("")}),a}({selector:c("2"),label:"Exact Word Search",width:6,change:r(p,function(e){return function(t){return e.search(t)}}(p))}).appendTo(f),u}}()}(DATA_DISPLAY);