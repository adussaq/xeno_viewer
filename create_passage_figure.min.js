!function(e){"use strict";const t=/^(none|-)$/i,n=function(e){return e.replace(/\s+/," ").trim()},r=function(e){let t=n(e.value),r=new Date(t.replace(/[^\d\/]+/g,"").replace(/\/+/g,"/").replace(/^10\/210\/09$/,"10/21/09").replace(/8\/24\/812/,"8/24/12"));return isNaN(r.getDate())&&console.warn("bad dateStr",t),r};let a;a=function(e,t,n){e[t].color=n,1===e[t].next.length&&a(e,e[t].next[0],n)};e.createPassageFigure=function(i,o,c){let d=function(e){let a={exp_id:{},act_id:{}};return e.forEach(function(e){let i,o,c,d,l=1;if(i=e.entry_data.filter(e=>e.key.match(/\s*New\s*Exp\s*#\s*/i)),o=e.entry_data.filter(e=>e.key.match(/\s*Old\s*Exp\s*#\s*/i)&&!e.value.match(t)),d=e.entry_data.filter(e=>e.key.match(/\s*Passage\s*Date\s*/i)).map(r),d=d.length>1?new Date(d.reduce(function(e,t){return Math.max(new Date(e),new Date(t))})):1===d.length?new Date(d):0,1===i.length)c=n(i[0].value);else if(i.length>1)c=i.map(e=>n(e.value)).join("&");else for(c="undefined"+l;a.exp_id.hasOwnProperty(c);)c="undefined"+(l+=1);c=n(c),a.exp_id[c]=a.exp_id[c]||{self:[],next:[],prior:[]},o.forEach(function(e){let t=n(e.value);a.exp_id[t]=a.exp_id[t]||{self:[],next:[],prior:[]}}),a.act_id[e._id]=e,a.exp_id[c].self.push(e._id),a.exp_id[c].date=a.exp_id[c].date||d,a.exp_id[c].date=new Date(Math.max(d,a.exp_id[c].date)),a.exp_id[c].prior=a.exp_id[c].prior.concat(o.map(function(e){return n(e.value)}))}),a}(i);!function(t){const n=Object.keys(t).map(e=>t[e].date&&t[e].date.valueOf()).filter(e=>e).reduce((e,t)=>Math.min(e,t))-1728e5;Object.keys(t).forEach(function(e){t[e].date&&t[e].date.valueOf()?t[e].type="fixed":(t[e].date=new Date(n),t[e].type="free"),t[e].prior.forEach(function(n){t[n].next.push(e)})});const r=Object.keys(t).filter(e=>1!==t[e].prior.length||1!==t[t[e].prior[0]].next.length),i=e.generateColor(r.length);r.forEach(function(e,n){a(t,e,i[n])}),Object.keys(t).sort((e,n)=>t[e].date-t[n].date).forEach(function(e,n){t[e].order=n})}(d.exp_id);const l=function(e){let t={};return Object.keys(e.exp_id).forEach(function(n){let r={name:n};const a=e.exp_id[n];r.self=a.self.map(e=>({id:e,circle:a.order,name:n})),r.self.length||r.self.push({id:void 0,name:n,circle:a.order}),t[n]=r}),Object.keys(e.exp_id).forEach(function(n){const r=e.exp_id[n];let a=t[n];a.next=r.next.map(e=>t[e].self).flat(),a.prior=r.prior.map(e=>t[e].self).flat()}),t}(d);return c&&"object"==typeof c&&(c.state=l[c.name]),{figure:function(e,t,n){let r={nodes:[],links:[]};return Object.keys(e).forEach(function(a){r.nodes.push({id:e[a].order,name:a,date:new Date(e[a].date.getFullYear(),e[a].date.getMonth()).toGMTString(),from:e[a].color,type:e[a].type,click:function(){n(t[a],a)}}),e[a].next.forEach(function(t){r.links.push({source:e[a].order,target:e[t].order,type:"answeredby",color:e[t].color})})}),r.nodes=r.nodes.sort((e,t)=>e.id-t.id),r.links=r.links.sort((e,t)=>e.source-t.source),r}(d.exp_id,l,o)}}}(DATA_DISPLAY);