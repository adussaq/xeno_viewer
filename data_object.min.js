!function(n){"use strict";const t=new RegExp("[^A-Za-z0-9]+","i"),e="http://db.kinomecore.com/2.0.0/passages/passages/";let r;r=function(n){if("object"!=typeof n||null===n)return n;let t;return n instanceof Array?t=n.map(r):(t={},Object.keys(n).forEach(function(e){t[e]=r(n[e])})),t};const c=function(n,t){return function(r){return Promise.all(function(n){let t={};return console.log(n),n.forEach(function(n){t[n.id]=t[n.id]||{},"object"==typeof n.value?t[n.id][n.key]=n.value:t[n.id][n.key+".value"]=n.value}),Object.keys(t).map(n=>(function(n,t){return function(n,t,e){return e||(e="GET"),fetch(n,{method:e,mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(t)}).then(function(n){return n.json()})}(e+n,t,"PATCH").then(function(n){return n.data[0]})})(n,t[n]))}(r)).then(function(e){return e.map(function(e){return t.set(e._id,e),n.ind[e._id].forEach(function(n){n()}),n.group.forEach(function(n){n.id.match(e._id)&&n.func()}),e._id})})}},o=function(){let n,e,r;return e=function(n,t){return!(!n||""===n)&&r.indexOf(n)===t},n=function(n){let e,r=[];for(e=0;e<n.length;e+=1)r=(r=r.concat(n[e].key.split(t))).concat(n[e].value.split(t));return r},function(c){let o,i={};return o=["description","entry_data","entry_metadata","entry_name","historical","origin_id","pdx_id"],c.forEach(function(c){r=(r=[]).concat(c[o[0]].split(t)),r=r.concat(c[o[3]].split(t)),r=r.concat([c[o[4]]]),r=r.concat([c[o[5]]]),r=r.concat(c[o[4]].split(t)),r=r.concat(c[o[5]].split(t)),r=r.concat(n(c[o[1]])),r=r.concat(n(c[o[2]])),(r=r.filter(e)).forEach(function(n){n=n.toLocaleLowerCase(),i[n]=i[n]||[],i[n].push(c._id)})}),i}}();n.expandData=function(e,i,u){let f,a={},l={ind:{},group:[]};return i||(u=function(n){let t={};n.forEach(function(n){t[n._id]=n});let e=function(n){return r(t[n])};return e.set=function(n,e){t[n]=e},e}(e),a.build=function(n,t){let e,r,c;return c=function(){return!1},r=function(e,o,i){i=i||{};let u=o(e.map(function(t){return n(t)})),f=t.group.length;return t.group.push({id:e.join("|&|&|&|&|"),func:function(){let n=r(e,o);u.replaceWith(n),t.group[f].id="",t.group[f].func=c}}),i.clear=function(){t.group[f].id="",t.group[f].func=c},u},e=function(o,i,u){if(u=u||{},Array.isArray(o))return r(o,i,u);t.ind[o]=t.ind[o]||[];let f=t.ind[o].length,a=i(n(o));return t.ind[o].push(function(){let n=e(o,i);a.replaceWith(n),t.ind[o][f]=c,u.change&&"function"==typeof u.change&&u.change()}),u.clear=function(){t.ind[o][f]=c},a}}(u,l)),a.list=function(n){return function(t){let e={};return n.forEach(function(n){e[n[t]]=1}),Object.keys(e).filter(n=>n)}}(e),a.filter=function(n){return function(t){return n.filter(t).map(n=>n._id)}}(e),a.clearUpdates=function(){l={ind:{},group:{}}},f=o(e),a.search=function(n){return function(e){let r={},c=e.toLocaleLowerCase().split(t);return c.forEach(function(t,e){n.hasOwnProperty(t)&&n[t].forEach(function(n){r[n]=r[n]||0,r[n]+=2-(e+1)/c.length})}),Object.keys(r).sort((n,t)=>r[t]-r[n])}}(f),a.set=c(l,u),a.expandIDs=function(t){return function(e){return n.expandData(e.map(function(n){return t(n)}),!0,t)}}(u),a}}(DATA_DISPLAY);