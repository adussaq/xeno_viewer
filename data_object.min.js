!function(n){"use strict";const t=new RegExp("[^A-Za-z0-9]+","i"),e="http://db.kinomecore.com/2.0.0/passages/passages/";let o;o=function(n){if("object"!=typeof n||null===n)return n;let t;return n instanceof Array?t=n.map(o):(t={},Object.keys(n).forEach(function(e){t[e]=o(n[e])})),t};const c=function(n,t){return function(o){return Promise.all(function(n){let o={};return console.log(n),n.forEach(function(n){o[n.id]=o[n.id]||{},"object"==typeof n.value?o[n.id][n.key]=n.value:o[n.id][n.key+".value"]=n.value}),Object.keys(o).map(n=>(function(n,o){console.log(e+n,o);let c=t(n);return Object.keys(o).forEach(function(n){let t=n.split(/\./),e=c,r=t.pop();t.forEach(function(n){e=e[n]}),e[r]=o[n]}),console.log(c),Promise.resolve(c)})(n,o[n]))}(o)).then(function(e){return e.map(function(e){return t.set(e._id,e),n.ind[e._id].forEach(function(n){n()}),n.group.forEach(function(n){n.id.match(e._id)&&n.func()}),e._id})})}},r=function(){let n,e,o;return e=function(n,t){return!(!n||""===n)&&o.indexOf(n)===t},n=function(n){let e,o=[];for(e=0;e<n.length;e+=1)o=(o=o.concat(n[e].key.split(t))).concat(n[e].value.split(t));return o},function(c){let r,i={};return r=["description","entry_data","entry_metadata","entry_name","historical","origin_id","pdx_id"],c.forEach(function(c){o=(o=[]).concat(c[r[0]].split(t)),o=o.concat(c[r[3]].split(t)),o=o.concat([c[r[4]]]),o=o.concat([c[r[5]]]),o=o.concat(c[r[4]].split(t)),o=o.concat(c[r[5]].split(t)),o=o.concat(n(c[r[1]])),o=o.concat(n(c[r[2]])),(o=o.filter(e)).forEach(function(n){n=n.toLocaleLowerCase(),i[n]=i[n]||[],i[n].push(c._id)})}),i}}();n.expandData=function(e,i,u){let f,a={},l={ind:{},group:[]};return i||(u=function(n){let t={};n.forEach(function(n){t[n._id]=n});let e=function(n){return o(t[n])};return e.set=function(n,e){t[n]=e},e}(e),a.build=function(n,t){let e,o,c;return c=function(){return!1},o=function(e,r,i){i=i||{};let u=r(e.map(function(t){return n(t)})),f=t.group.length;return t.group.push({id:e.join("|&|&|&|&|"),func:function(){let n=o(e,r);u.replaceWith(n),t.group[f].id="",t.group[f].func=c}}),i.clear=function(){t.group[f].id="",t.group[f].func=c},u},e=function(r,i,u){if(u=u||{},Array.isArray(r))return o(r,i,u);t.ind[r]=t.ind[r]||[];let f=t.ind[r].length,a=i(n(r));return t.ind[r].push(function(){let n=e(r,i);a.replaceWith(n),t.ind[r][f]=c,u.change&&"function"==typeof u.change&&u.change()}),u.clear=function(){t.ind[r][f]=c},a}}(u,l)),a.list=function(n){return function(t){let e={};return n.forEach(function(n){e[n[t]]=1}),Object.keys(e).filter(n=>n)}}(e),a.filter=function(n){return function(t){return n.filter(t).map(n=>n._id)}}(e),a.clearUpdates=function(){l={ind:{},group:{}}},f=r(e),a.search=function(n){return function(e){let o={},c=e.toLocaleLowerCase().split(t);return c.forEach(function(t,e){n.hasOwnProperty(t)&&n[t].forEach(function(n){o[n]=o[n]||0,o[n]+=2-(e+1)/c.length})}),Object.keys(o).sort((n,t)=>o[t]-o[n])}}(f),a.set=c(l,u),a.expandIDs=function(t){return function(e){return n.expandData(e.map(function(n){return t(n)}),!0,t)}}(u),a}}(DATA_DISPLAY);