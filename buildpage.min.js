!function(e){"use strict";var t,n,a,r,o,l,d,s=$("#form-body"),i=$("#data-body");r=function(){var e,n,a,r;return n=function(e){var t=new Date(e.replace(/[^\d\/]+/g,"").replace(/\/+/g,"/").replace(/^10\/210\/09$/,"10/21/09").replace(/8\/24\/812/,"8/24/12"));return isNaN(t.getDate())&&console.warn("bad dateStr",e),t},a=function(e){return function(t,n){return e[t].date-e[n].date}},r=function(e,n,a){return function(r){var o,l,d,s,i="";for(console.log(r,e,n,n[e]),l=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Prior",class:"text-center"})),s=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Current",class:"text-center"})),d=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Next",class:"text-center"})),o=0;o<n[e].old.length;o+=1)n[e].old[o].self?l.append(t(n[e].old[o].self,!0,"Circle "+n[e].old[o].order)):l.append(t({entry_data:[{key:"New Exp#",value:n[e].old[o].id}]},!0,"Circle "+n[e].old[o].order));for(n[e].self?s.append(t(n[e].self,!0,"Circle "+n[e].order)):s.append(t({entry_data:[{key:"New Exp#",value:e}]},!0,"Circle "+n[e].order)),o=0;o<n[e].next.length;o+=1)n[e].next[o].self?d.append(t(n[e].next[o].self,!0,"Circle "+n[e].next[o].order)):d.append(t({entry_data:[{key:"New Exp#",value:n[e].next[o].id}]},!0,"Circle "+n[e].next[o].order));i=i.replace(/,$/,""),a.empty().append(l).append(s).append(d)}},e=function(e,t){var o,l,d,s,i,p,c,u,f,h,g=new Set,y={};for(o=0;o<e.length;o+=1){for(f=0,h=0,c=0,l=0;l<e[o].entry_data.length;l+=1)e[o].entry_data[l].key.match(/new\sexp/i)?f=e[o].entry_data[l].value:e[o].entry_data[l].key.match(/old\sexp/i)?h=e[o].entry_data[l].value:e[o].entry_data[l].key.match(/Passage\sDate/i)&&(c=n(e[o].entry_data[l].value));f||(f=":undefined: "+Math.random().toString().replace(/0\./,"")),h||(h=":undefined: "+Math.random().toString().replace(/0\./,"")),h.match(/-|none/)||(h=h.replace(/^X(\d{2})(\d+)$/,"X$1-$2")),f.match(/-/)||(f=f.replace(/^X(\d{2})(\d+)$/,"X$1-$2")),f=f.replace(/[^\w\d\-\*\:]+/gi,""),(h=h.replace(/[^\w\d\-\*\:]+/gi,""))===(f=(f="X"+f).replace(/X+/gi,"X"))&&(f=h+"&&dup1"),y[f]=y[f]||{self:[],date:[],id:f,old:[],next:[]},y[f].self.push(e[o]),y[f].date.push(c),h.match(/none/i)||(h=(h="X"+h).replace(/X+/gi,"X"),y[h]=y[h]||{self:[],date:[],id:h,old:[],next:[]},y[h].next.push(y[f]),y[f].old.push(y[h]))}u=Object.keys(y);var m,x;for(o=0;o<u.length;o+=1)if(y[u[o]].self.length>1){for(m=y[u[o]],x=[],delete y[u[o]],l=0;l<m.self.length;l+=1)x.push(u[o]+"&&dup"+l),y[u[o]+"&&dup"+l]={self:[m.self[l]],date:[m.date[l]],id:f,old:m.old,next:m.next};for(l=0;l<m.old.length;l+=1){for(d=0;d<m.old[l].next.length;d+=1)m.old[l].next[d].self.length>1&&m.old[l].next.splice(d,1);for(d=0;d<x.length;d+=1)m.old[l].next.push(y[x[d]])}}u=Object.keys(y);var v=new Date;for(o=0;o<u.length;o+=1)y[u[o]].self=y[u[o]].self[0],y[u[o]].date=y[u[o]].date[0],y[u[o]].date&&(v=Math.min(v,y[u[o]].date));for(o=0;o<u.length;o+=1)y[u[o]].date?y[u[o]].type="fixed":(y[u[o]].type="free",y[u[o]].date=new Date(v));for(o=0;o<u.length;o+=1)if(1!==y[u[o]].old.length&&g.add(u[o]),y[u[o]].next.length>1)for(l=0;l<y[u[o]].next.length;l+=1)g.add(y[u[o]].next[l].id);for(i=DATA_DISPLAY.generateColor(g.size+1),o=0,g.forEach(function(e){for(y[e].nodeColor=i[o],s=y[e].next;1===s.length;)s[0].nodeColor=i[o],s=s[0].next;o+=1}),u=u.sort(a(y)),o=0;o<u.length;o+=1)y[u[o]].order=o;for(p={nodes:[],links:[]},o=0;o<u.length;o+=1)for(p.nodes.push({name:y[u[o]].id,date:y[u[o]].date.toGMTString().replace(/^[\s\S]+(\w{3}\s\d{4})[\s\S]+$/i,"$1"),id:y[u[o]].order,from:y[u[o]].nodeColor,type:y[u[o]].type,click:r(u[o],y,t)}),l=0;l<y[u[o]].next.length;l+=1)p.links.push({source:y[u[o]].order,target:y[u[o]].next[l].order,type:"answeredby",color:y[u[o]].next[l].nodeColor});return console.log("nums",g,y),p},function(t,n){var a,r,o,l,d={};for(a=0;a<t.length;a+=1)d[t[a].pdx_id]=d[t[a].pdx_id]||{},d[t[a].pdx_id][t[a].entry_name]=d[t[a].pdx_id][t[a].entry_name]||[],d[t[a].pdx_id][t[a].entry_name].push(t[a]);r=Object.keys(d);var s,i;for(console.log(d),a=0;a<r.length;a+=1)d[r[a]].hasOwnProperty("PDX Passage Info")&&(i=Math.random().toString().replace(/^0\./,""),(s=$("<div>",{class:"row"}).appendTo(n)).append($("<h4>Passage Information Timeline</h4>")),s.append($("<div>",{id:"timelinefig"+i,class:"text-center chart"})),(l=$("<div>",{class:"row"})).appendTo(n),o=e(d[r[a]]["PDX Passage Info"],l),console.log("*****",o),loadchart("timelinefig"+i,o))}}(),n=function(){var e;return e=function(e){var t=0,n={summary:[],data_availiable:[]};for(t=0;t<e.length;t+=1)"Summary Table"===e[t].entry_name?n.summary.push(e[t]):"PDX_ID to old PDX_ID_OldKinomic/Affy/Illumina ID's"!==e[t].entry_name&&"PDX_ID to Nanostring naming and model information"!==e[t].entry_name||n.data_availiable.push(e[t]);return n},function(t,n){var a;return a=e(t),console.log(a),n}}(),d=function(){var e,a,o,l,d,s,p,c;return c=function(e){var t,n={};for(t=0;t<e.length;t+=1)n[e[t].pdx_id]=n[e[t].pdx_id]||[],n[e[t].pdx_id].push(e[t]);return{ids:Object.keys(n),data:n}},e=function(e,t){var a,o,d,s;for(console.log(t),i.empty(),i.append($("<p>",{class:"h2 row",text:e})),o=c(t),d=0;d<o.ids.length;d+=1)s=o.data[o.ids[d]],i.append($("<p>",{class:"h3 row",text:"PDX ID: "+o.ids[d]})),a=$("<div>",{class:"row"}),i.append(a),a=$("<div>",{class:"col-12"}).appendTo(a),n(s,a),a=$("<div>",{class:"row"}),i.append(a),a=$("<div>",{class:"col-12"}).appendTo(a),r(s,a),i.append($("<p>",{class:"h4 row",text:"All Descriptive Data"})),i.append(l(s))},s=function(e,t,n){var a=n>1?" entries)":" entry)";return $("<div>",{class:"card-header",id:"heading"+t}).append($("<h2>",{class:"mb-0"}).append($("<button>",{class:"btn btn-link collapsed",type:"button","data-toggle":"collapse","data-target":"#collapse"+t,"aria-expanded":"false","aria-controls":"collapse"+t,html:e+" ("+n+a})))},t=function(e,t,n){var a,r="";for(e.pdx_id=e.pdx_id||"N/A",e.entry_name=e.entry_name||"N/A",e.description=e.description||"N/A",e.entry_metadata=e.entry_metadata||{},e.entry_metadata.user=e.entry_metadata.user||"N/A",e.entry_data=e.entry_data||[],r+='<p class="h5">'+e.pdx_id+": "+e.entry_name+'</p><p class="font-weight-light text-muted">'+e.description+"<br />-"+e.entry_metadata.user+'</p><p><ul class="list-group">',t&&(r='<p class="lead">'+e.pdx_id+": "+n+"</p>"),a=0;a<e.entry_data.length;a+=1)r+='<li class="list-group-item"><strong>'+e.entry_data[a].key+":</strong> &emsp; "+e.entry_data[a].value+"</li>";return r+="</ul></p><hr />",$(r)},p=function(e,n){var a,r,o;for(a=$("<div>",{id:"collapse"+n,class:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionHolder"}),r=$("<div>",{class:"card-body"}),o=0;o<e.length;o+=1)r.append(t(e[o]));return console.log("in entry builder body",e),a.append(r),a},l=function(e){var t,n,r,o,l,d;for(n=a(e),t=Object.keys(n),d=$("<div>",{class:"row"}),o=$("<div>",{class:"accordion",style:"margin-bottom: 10px;",id:"accordionHolder"}).appendTo(d),r=0;r<t.length;r+=1)l=Math.random().toString().replace(/^0\./,""),o.append($("<div>",{class:"card"}).append(s(t[r],l,n[t[r]].length)).append(p(n[t[r]],l)));return d},d=function(e,t){return o(t)-o(e)},o=function(e){var t,n,a=-1/0;for(t=0;t<e.entry_data.length;t+=1)e.entry_data[t].value.match(/\d{1,2}\/\d{1,2}\/\d{1,2}/)&&(n=Date.parse(e.entry_data[t].value))&&(a=Math.max(n,a));return a},a=function(e){var t=0,n={},a=[];for(t=0;t<e.length;t+=1)n[e[t].entry_name]=n[e[t].entry_name]||[],n[e[t].entry_name].push(e[t]),a.push(e[t].entry_name);for(t=0;t<a.length;t+=1)n[a[t]]=n[a[t]].sort(d);return n},e}(),a=function(){var e,t,n,a;return a=new RegExp("[^A-Za-z0-9]+","i"),t=function(e,t){return!(!e||""===e)&&n.indexOf(e)===t},e=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n=(n=n.concat(e[t].key.split(a))).concat(e[t].value.split(a));return n},function(r){var o,l,d,s,i={};for(s=["description","entry_data","entry_metadata","entry_name","historical","origin_id","pdx_id"],o=0;o<r.length;o+=1)for(n=[],Object.defineProperty(r[o],"search_temp_key",{value:Math.random().toString().replace(/0\./,""),writable:!1,enumerable:!1,configurable:!1}),n=n.concat(r[o][s[0]].split(a)),n=n.concat(r[o][s[3]].split(a)),n=n.concat([r[o][s[4]]]),n=n.concat([r[o][s[5]]]),n=n.concat(r[o][s[4]].split(a)),n=n.concat(r[o][s[5]].split(a)),n=n.concat(e(r[o][s[1]])),n=n.concat(e(r[o][s[2]])),n=n.filter(t),l=0;l<n.length;l+=1)i[d=n[l].toLocaleLowerCase()]=i[d]||[],i[d].push(r[o]);return i}}(),o=function(e){var t,n,r,o,i,p,c,u,f,h,g,y,m,x=l(e),v=Object.keys(x),_=a(e),b=!1;for(r=[],i=function(){b||(b=!0,setTimeout(u,1e3))},u=function(){b?(b=!1,setTimeout(u,1e3)):c(p.val())},g=function(e,t){var n,a;return n=1*e.replace(/[^0-9]+/gi,""),a=1*t.replace(/[^0-9]+/gi,""),n&&a&&n>2&&a>2&&n-a!=0?n-a:e>t?1:t>e?-1:0},c=function(e){var t,n,a,r,o=[],l={},s=0;for(f(),t=e.toLocaleLowerCase().split(/\s+/),n=0;n<t.length;n+=1)if(_.hasOwnProperty(t[n]))for(a=0;a<_[t[n]].length;a+=1)o.push(_[t[n]][a]),l[_[t[n]][a].search_temp_key]=l[_[t[n]][a].search_temp_key]||[0,_[t[n]][a]],l[_[t[n]][a].search_temp_key][0]+=1,s=Math.max(l[_[t[n]][a].search_temp_key][0],s);if(s>1)for(o=[],r=Object.keys(l),n=0;n<r.length;n+=1)l[r[n]][0]>=s&&o.push(l[r[n]][1]);d("Search: '"+e+"'",o),console.log(o)},f=function(){var e;for(e=0;e<r.length;e+=1)r[e].select[0][0].selected=!0},h=function(){p.val("")},o=function(e){var t,n;for(e.preventDefault(),h(),t=this.value.split(";").map(function(e){return 1*e}),console.log(t),console.log(r),n=0;n<r.length;n+=1)n!==t[0]&&(console.log(n,t[0]),r[n].select[0][0].selected=!0);d(v[t[0]]+": "+r[t[0]].option_keys[t[1]],x[v[t[0]]][r[t[0]].option_keys[t[1]]])},y=0;y<v.length;y+=1){for(n=$("<select>",{class:"form-control",id:"select headers"+y}),s.append($("<div>",{class:"form-group col-3"}).append($("<label>",{for:"select headers"+y,text:v[y]})).append(n)),t=Object.keys(x[v[y]]).sort(g),$("<option>",{text:"Select one...",disabled:"disabled",selected:"selected"}).appendTo(n),r[y]={select:n,option_keys:JSON.parse(JSON.stringify(t)),options:[]},m=0;m<t.length;m+=1)r[y].options[m]=$("<option>",{text:t[m],val:y+";"+m}).appendTo(n);n.on("change",o)}console.log(_),p=$("<input>",{type:"text",style:"height: 100%",class:"form-control","aria-label":"Default","aria-describedby":"searchBarInuput439201432"}).on("keyup",i),$("<div>",{class:"input-group mb-3 col-6"}).append($("<div>",{class:"input-group-prepend"}).append($("<span>",{class:"input-group-text",id:"searchBarInuput439201432",html:"Exact Word Search"}))).append(p).appendTo(s)},l=function(e){var t,n={pdx_id:{},origin_id:{}},a=Object.keys(n);return e.map(function(e){for(t=0;t<a.length;t+=1)e.hasOwnProperty(a[t])&&(n[a[t]]=n[a[t]]||{},n[a[t]][e[a[t]]]=n[a[t]][e[a[t]]]||[],n[a[t]][e[a[t]]].push(e))}),n},e.build_page=o}(DATA_DISPLAY);