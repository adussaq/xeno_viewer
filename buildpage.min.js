!function(e){"use strict";var a,t,n,r,l,d,o,i,s=$("#form-body"),c=$("#data-body");i=new RegExp("[^A-Za-z0-9]+","i"),r=function(){var e,t,n,r;return t=function(e){var a=new Date(e.replace(/[^\d\/]+/g,"").replace(/\/+/g,"/").replace(/^10\/210\/09$/,"10/21/09").replace(/8\/24\/812/,"8/24/12"));return isNaN(a.getDate())&&console.warn("bad dateStr",e),a},n=function(e){return function(a,t){return e[a].date-e[t].date}},r=function(e,t,n){return function(){var r,l,d,o,i="";for(l=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Prior",class:"text-center"})),o=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Current",class:"text-center"})),d=$("<div>",{class:"col-md-4 col-sm-12",style:"border: 2px solid grey;border-radius: 5px;max-height: 200px;overflow-y:scroll;overflow: -moz-scrollbars-vertical;"}).append($("<h4>",{text:"Next",class:"text-center"})),r=0;r<t[e].old.length;r+=1)t[e].old[r].self?l.append(a(t[e].old[r].self,!0,"Circle "+t[e].old[r].order)):l.append(a({entry_data:[{key:"New Exp#",value:t[e].old[r].id}]},!0,"Circle "+t[e].old[r].order));for(t[e].self?o.append(a(t[e].self,!0,"Circle "+t[e].order)):o.append(a({entry_data:[{key:"New Exp#",value:e}]},!0,"Circle "+t[e].order)),r=0;r<t[e].next.length;r+=1)t[e].next[r].self?d.append(a(t[e].next[r].self,!0,"Circle "+t[e].next[r].order)):d.append(a({entry_data:[{key:"New Exp#",value:t[e].next[r].id}]},!0,"Circle "+t[e].next[r].order));i=i.replace(/,$/,""),n.empty().append(l).append(o).append(d)}},e=function(e,a){var l,d,o,i,s,c,p,u,h,f,y=new Set,m={};for(l=0;l<e.length;l+=1){for(h=0,f=0,p=0,d=0;d<e[l].entry_data.length;d+=1)e[l].entry_data[d].key.match(/new\sexp/i)?h=e[l].entry_data[d].value:e[l].entry_data[d].key.match(/old\sexp/i)?f=e[l].entry_data[d].value:e[l].entry_data[d].key.match(/Passage\sDate/i)&&(p=t(e[l].entry_data[d].value));h||(h=":undefined: "+Math.random().toString().replace(/0\./,"")),f||(f=":undefined: "+Math.random().toString().replace(/0\./,"")),f.match(/-|none/)||(f=f.replace(/^X(\d{2})(\d+)$/,"X$1-$2")),h.match(/-/)||(h=h.replace(/^X(\d{2})(\d+)$/,"X$1-$2")),h=h.replace(/[^\w\d\-\*\:]+/gi,""),(f=f.replace(/[^\w\d\-\*\:]+/gi,""))===(h=(h="X"+h).replace(/X+/gi,"X"))&&(h=f+"&&dup1"),m[h]=m[h]||{self:[],date:[],id:h,old:[],next:[]},m[h].self.push(e[l]),m[h].date.push(p),f.match(/none/i)||(f=(f="X"+f).replace(/X+/gi,"X"),m[f]=m[f]||{self:[],date:[],id:f,old:[],next:[]},m[f].next.push(m[h]),m[h].old.push(m[f]))}u=Object.keys(m);var _,v;for(l=0;l<u.length;l+=1)if(m[u[l]].self.length>1){for(_=m[u[l]],v=[],delete m[u[l]],d=0;d<_.self.length;d+=1)v.push(u[l]+"&&dup"+d),m[u[l]+"&&dup"+d]={self:[_.self[d]],date:[_.date[d]],id:h,old:_.old,next:_.next};for(d=0;d<_.old.length;d+=1){for(o=0;o<_.old[d].next.length;o+=1)_.old[d].next[o].self.length>1&&_.old[d].next.splice(o,1);for(o=0;o<v.length;o+=1)_.old[d].next.push(m[v[o]])}}u=Object.keys(m);var g=new Date;for(l=0;l<u.length;l+=1)m[u[l]].self=m[u[l]].self[0],m[u[l]].date=m[u[l]].date[0],m[u[l]].date&&(g=Math.min(g,m[u[l]].date));for(l=0;l<u.length;l+=1)m[u[l]].date?m[u[l]].type="fixed":(m[u[l]].type="free",m[u[l]].date=new Date(g));for(l=0;l<u.length;l+=1)if(1!==m[u[l]].old.length&&y.add(u[l]),m[u[l]].next.length>1)for(d=0;d<m[u[l]].next.length;d+=1)y.add(m[u[l]].next[d].id);for(s=DATA_DISPLAY.generateColor(y.size+1),l=0,y.forEach(function(e){for(m[e].nodeColor=s[l],i=m[e].next;1===i.length;)i[0].nodeColor=s[l],i=i[0].next;l+=1}),u=u.sort(n(m)),l=0;l<u.length;l+=1)m[u[l]].order=l;for(c={nodes:[],links:[]},l=0;l<u.length;l+=1)for(c.nodes.push({name:m[u[l]].id,date:m[u[l]].date.toGMTString().replace(/^[\s\S]+(\w{3}\s\d{4})[\s\S]+$/i,"$1"),id:m[u[l]].order,from:m[u[l]].nodeColor,type:m[u[l]].type,click:r(u[l],m,a)}),d=0;d<m[u[l]].next.length;d+=1)c.links.push({source:m[u[l]].order,target:m[u[l]].next[d].order,type:"answeredby",color:m[u[l]].next[d].nodeColor});return c},function(a,t){var n,r,l,d,o={};for(n=0;n<a.length;n+=1)o[a[n].pdx_id]=o[a[n].pdx_id]||{},o[a[n].pdx_id][a[n].entry_name]=o[a[n].pdx_id][a[n].entry_name]||[],o[a[n].pdx_id][a[n].entry_name].push(a[n]);r=Object.keys(o);var i,s;for(n=0;n<r.length;n+=1)o[r[n]].hasOwnProperty("PDX Passage Info")&&(s=Math.random().toString().replace(/^0\./,""),(i=$("<div>",{class:"row"}).appendTo(t)).append($("<h4>Passage Information Timeline</h4>")),i.append($("<div>",{id:"timelinefig"+s,class:"text-center chart"})),(d=$("<div>",{class:"row"})).appendTo(t),l=e(o[r[n]]["PDX Passage Info"],d),loadchart("timelinefig"+s,l))}}(),t=function(){var e;return e=function(e){var a=0,t={summary:[],data_availiable:[]};for(a=0;a<e.length;a+=1)"Summary Table"===e[a].entry_name?t.summary.push(e[a]):"PDX_ID to old PDX_ID_OldKinomic/Affy/Illumina ID's"!==e[a].entry_name&&"PDX_ID to Nanostring naming and model information"!==e[a].entry_name||t.data_availiable.push(e[a]);return t},function(a,t){var n,r,l,d,o,i,s,c,p,u,h,f,y;if(n=e(a),r=$("<div>",{class:"row"}).appendTo(t),n.data_availiable.length)for($("<div>",{class:"col-12 h4",text:"Avaliable Data"}).appendTo(r),r=$("<dl>",{class:"row"}).appendTo($("<div>",{class:"col-12"}).appendTo(r)),l=0;l<n.data_availiable.length;l+=1){if(n.data_availiable[l].entry_name.match(/NanoString/i)){for(d=0;d<n.data_availiable[l].entry_data.length;d+=1)n.data_availiable[l].entry_data[d].key.match(/Nsname_model/)?c=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Model/)?o=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Comment/)?i=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Class\ Name/)&&(s=n.data_availiable[l].entry_data[d].value);o=o.charAt(0).toUpperCase()+o.slice(1),$('<dt class="col-sm-3">NanoString</dt> <dd class="col-sm-9">'+o+" ("+i+"): "+c+" ("+s+")</dd>").appendTo(r)}if(n.data_availiable[l].entry_name.match(/PDX_ID_OldKinomic/i)){for(u="",h="",f="",y="",d=0;d<n.data_availiable[l].entry_data.length;d+=1)n.data_availiable[l].entry_data[d].key.match(/Kinomics_Sample/)?u=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Affy_Sample\ ID/)?h=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Illumina_ID/)?f=n.data_availiable[l].entry_data[d].value:n.data_availiable[l].entry_data[d].key.match(/Illumina_SentrixPosition/)&&(y=n.data_availiable[l].entry_data[d].value);u.length&&(p="http://toolbox.kinomecore.com/?data="+encodeURIComponent('*[http://db.kinomecore.com/1.0.0/lvl_1.1.2?find={"sample_data":{"$elemMatch":{"value":"'+u+'"}}}]*'),$('<dt class="col-sm-3">Kinomics</dt><dd class="col-sm-9"><a href="'+p+'">'+u+"</a></dd>").appendTo(r)),h.length&&$('<dt class="col-sm-3">Affymetrix:</dt> <dd class="col-sm-9">'+h+"</dd>").appendTo(r),f.length&&$('<dt class="col-sm-3">Illumina:</dt> <dd class="col-sm-9">'+f+" (pos: "+y+")</dd>").appendTo(r)}}return console.log("summary information",n),t}}(),o=function(){var e,n,l,d,o,i,s,p;return p=function(e){var a,t={};for(a=0;a<e.length;a+=1)t[e[a].pdx_id]=t[e[a].pdx_id]||[],t[e[a].pdx_id].push(e[a]);return{ids:Object.keys(t),data:t}},e=function(e,a){var n,l,o,i;for(console.log("Data Selected",a),c.empty(),c.append($("<p>",{class:"h2 row",text:e})),l=p(a),o=0;o<l.ids.length;o+=1)i=l.data[l.ids[o]],c.append($("<p>",{class:"h3 row",text:"PDX ID: "+l.ids[o]})),n=$("<div>",{class:"row"}),c.append(n),n=$("<div>",{class:"col-12"}).appendTo(n),t(i,n),n=$("<div>",{class:"row"}),c.append(n),n=$("<div>",{class:"col-12"}).appendTo(n),r(i,n),c.append($("<p>",{class:"h4 row",text:"All Descriptive Data"})),c.append(d(i))},i=function(e,a,t){var n=t>1?" entries)":" entry)";return $("<div>",{class:"card-header",id:"heading"+a}).append($("<h2>",{class:"mb-0"}).append($("<button>",{class:"btn btn-link collapsed",type:"button","data-toggle":"collapse","data-target":"#collapse"+a,"aria-expanded":"false","aria-controls":"collapse"+a,html:e+" ("+t+n})))},a=function(e,a,t){var n,r="";for(e.pdx_id=e.pdx_id||"N/A",e.entry_name=e.entry_name||"N/A",e.description=e.description||"N/A",e.entry_metadata=e.entry_metadata||{},e.entry_metadata.user=e.entry_metadata.user||"N/A",e.entry_data=e.entry_data||[],r+='<p class="h5">'+e.pdx_id+": "+e.entry_name+'</p><p class="font-weight-light text-muted">'+e.description+"<br />-"+e.entry_metadata.user+'</p><p><ul class="list-group">',a&&(r='<p class="lead">'+e.pdx_id+": "+t+"</p>"),n=0;n<e.entry_data.length;n+=1)r+='<li class="list-group-item"><strong>'+e.entry_data[n].key+":</strong> &emsp; "+e.entry_data[n].value+"</li>";return r+="</ul></p><hr />",$(r)},s=function(e,t){var n,r,l;for(n=$("<div>",{id:"collapse"+t,class:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionHolder"}),r=$("<div>",{class:"card-body"}),l=0;l<e.length;l+=1)r.append(a(e[l]));return n.append(r),n},d=function(e){var a,t,r,l,d,o;for(t=n(e),a=Object.keys(t),o=$("<div>",{class:"row"}),l=$("<div>",{class:"accordion",style:"margin-bottom: 10px;",id:"accordionHolder"}).appendTo(o),r=0;r<a.length;r+=1)d=Math.random().toString().replace(/^0\./,""),l.append($("<div>",{class:"card"}).append(i(a[r],d,t[a[r]].length)).append(s(t[a[r]],d)));return o},o=function(e,a){return l(a)-l(e)},l=function(e){var a,t,n=-1/0;for(a=0;a<e.entry_data.length;a+=1)e.entry_data[a].value.match(/\d{1,2}\/\d{1,2}\/\d{1,2}/)&&(t=Date.parse(e.entry_data[a].value))&&(n=Math.max(t,n));return n},n=function(e){var a=0,t={},n=[];for(a=0;a<e.length;a+=1)t[e[a].entry_name]=t[e[a].entry_name]||[],t[e[a].entry_name].push(e[a]),n.push(e[a].entry_name);for(a=0;a<n.length;a+=1)t[n[a]]=t[n[a]].sort(o);return t},e}(),n=function(){var e,a,t;return a=function(e,a){return!(!e||""===e)&&t.indexOf(e)===a},e=function(e){var a,t=[];for(a=0;a<e.length;a+=1)t=(t=t.concat(e[a].key.split(i))).concat(e[a].value.split(i));return t},function(n){var r,l,d,o,s={};for(o=["description","entry_data","entry_metadata","entry_name","historical","origin_id","pdx_id"],r=0;r<n.length;r+=1)for(t=[],Object.defineProperty(n[r],"search_temp_key",{value:Math.random().toString().replace(/0\./,""),writable:!1,enumerable:!1,configurable:!1}),t=t.concat(n[r][o[0]].split(i)),t=t.concat(n[r][o[3]].split(i)),t=t.concat([n[r][o[4]]]),t=t.concat([n[r][o[5]]]),t=t.concat(n[r][o[4]].split(i)),t=t.concat(n[r][o[5]].split(i)),t=t.concat(e(n[r][o[1]])),t=t.concat(e(n[r][o[2]])),t=t.filter(a),l=0;l<t.length;l+=1)s[d=t[l].toLocaleLowerCase()]=s[d]||[],s[d].push(n[r]);return s}}(),l=function(e){var a,t,r,l,c,p,u,h,f,y,m,_,v,g=d(e),x=Object.keys(g),b=n(e),k=!1;for(r=[],c=function(){k||(k=!0,setTimeout(h,1e3))},h=function(){k?(k=!1,setTimeout(h,1e3)):u(p.val())},m=function(e,a){var t,n;return t=1*e.replace(/[^0-9]+/gi,""),n=1*a.replace(/[^0-9]+/gi,""),t&&n&&t>2&&n>2&&t-n!=0?t-n:e>a?1:a>e?-1:0},u=function(e){var a,t,n,r,l=[],d={},s=0;for(f(),a=e.toLocaleLowerCase().split(i),t=0;t<a.length;t+=1)if(b.hasOwnProperty(a[t]))for(n=0;n<b[a[t]].length;n+=1)l.push(b[a[t]][n]),d[b[a[t]][n].search_temp_key]=d[b[a[t]][n].search_temp_key]||[{},b[a[t]][n]],d[b[a[t]][n].search_temp_key][0][a[t]]=1,s=Math.max(Object.keys(d[b[a[t]][n].search_temp_key][0]).length,s);if(s>1)for(l=[],r=Object.keys(d),t=0;t<r.length;t+=1)Object.keys(d[r[t]][0]).length>=s&&l.push(d[r[t]][1]);o("Search: '"+e+"'",l)},f=function(){var e;for(e=0;e<r.length;e+=1)r[e].select[0][0].selected=!0},y=function(){p.val("")},l=function(e){var a,t;for(e.preventDefault(),y(),a=this.value.split(";").map(function(e){return 1*e}),t=0;t<r.length;t+=1)t!==a[0]&&(r[t].select[0][0].selected=!0);o(x[a[0]]+": "+r[a[0]].option_keys[a[1]],g[x[a[0]]][r[a[0]].option_keys[a[1]]])},_=0;_<x.length;_+=1){for(t=$("<select>",{class:"form-control",id:"select headers"+_}),s.append($("<div>",{class:"form-group col-3"}).append($("<label>",{for:"select headers"+_,text:x[_]})).append(t)),a=Object.keys(g[x[_]]).sort(m),$("<option>",{text:"Select one...",disabled:"disabled",selected:"selected"}).appendTo(t),r[_]={select:t,option_keys:JSON.parse(JSON.stringify(a)),options:[]},v=0;v<a.length;v+=1)r[_].options[v]=$("<option>",{text:a[v],val:_+";"+v}).appendTo(t);t.on("change",l)}p=$("<input>",{type:"text",style:"height: 100%",class:"form-control","aria-label":"Default","aria-describedby":"searchBarInuput439201432"}).on("keyup",c),$("<div>",{class:"input-group mb-3 col-6"}).append($("<div>",{class:"input-group-prepend"}).append($("<span>",{class:"input-group-text",id:"searchBarInuput439201432",html:"Exact Word Search"}))).append(p).appendTo(s)},d=function(e){var a,t={pdx_id:{},origin_id:{}},n=Object.keys(t);return e.map(function(e){for(a=0;a<n.length;a+=1)e.hasOwnProperty(n[a])&&(t[n[a]]=t[n[a]]||{},t[n[a]][e[n[a]]]=t[n[a]][e[n[a]]]||[],t[n[a]][e[n[a]]].push(e))}),t},e.build_page=l}(DATA_DISPLAY);