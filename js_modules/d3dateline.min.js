function loadchart(t,e){function r(t){var e,r,a;if(t.source.x==t.target.x)t.source.y<t.target.y?(r=t.source,a=t.target):(a=t.target,r=t.source),e="M"+r.x+","+r.y+" C"+(r.x+d)+","+(r.y-s)+" "+(a.x+d)+","+(a.y+s)+" "+a.x+","+a.y;else{var n=t.target.x-t.source.x,i=Math.min(t.target.y-t.source.y,1),o=Math.sqrt(n*n+i*i);n>1e3&&(o=9e3),e="M"+t.source.x+","+t.source.y+"A"+o+","+o+" 0 0,1 "+t.target.x+","+t.target.y}return e}function a(t){var e=o+8,r=t.x-e,a=t.x+e,n=t.y-e,i=t.y+e;return function(e,s,d,c,l){if(e.point&&e.point!==t){var u=t.x-e.point.x,f=t.y-e.point.y,p=Math.sqrt(u*u+f*f),x=o+o;p<x&&(p=(p-x)/p*.5,t.x-=u*=p,t.y-=f*=p,e.point.x+=u,e.point.y+=f)}return s>a||c<r||d>i||l<n}}var n=200,i={top:40,right:40,bottom:0,left:40},o=10,s=10,d=35,c=(d3.svg.line(),new Date(e.nodes[0].date)),l=new Date(e.nodes[e.nodes.length-1].date),u=1.2*((l-c)/1e3/60/60/24);u=Math.max(u,480);var f=d3.select("#"+t).append("svg").attr("width",u).attr("height",n).attr("preserveAspectRatio","xMinYMin slice").append("g"),p=d3.time.scale().domain([d3.time.day.offset(c,-150),d3.time.day.offset(l,150)]).rangeRound([0,u-i.left-i.right]),x=d3.svg.axis().scale(p).orient("bottom").ticks(d3.time.years,1).tickSize(5).tickPadding(8);f.append("g").attr("class","x axis yearaxis").attr("transform","translate(0, "+(n-i.top-i.bottom)+")").call(x),f.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("class","arrowhead").attr("viewBox","0 -5 10 10").attr("refX",30).attr("refY",-1.8).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").style("fill",function(t){return t.color});var y=f.selectAll(".link").data(e.links).enter().append("svg:path").attr("d",function(t){return r(t)}).attr("class","link").attr("marker-end","url(#end)").style("stroke",function(t){return t.color}),g=[];e.nodes.forEach(function(t){if(t.x=p(new Date(t.date))+2*o,"fixed"==t.type){var e=g["d"+t.date]?g["d"+t.date]:0;g["d"+t.date]=e+1,t.y=n-i.bottom-i.top-o-1-e*o*2-e,t.fixed=!0}else t.y=0});var h=f.selectAll(".node").data(e.nodes).enter().append("g").attr("class","node");h.append("svg:circle").attr("id",function(t){return"n"+t.id}).attr("class",function(t){return"letter d"+t.date+" "+("fixed"==t.type?"precise":"notprecise")}).style("fill",function(t){return t.from}).attr("r",o);h.append("svg:title").text(function(t){return t.name}),h.append("text").attr("text-anchor","middle").attr("dy",o/2).attr("class","shadow").text(function(t){return t.id}),h.append("text").attr("text-anchor","middle").attr("dy",o/2).text(function(t){return t.id}),h.on("click",function(t){t.click(t)});self.force=d3.layout.force().nodes(e.nodes).links(e.links).gravity(0).charge(.1).distance(40).size([u,n]).start().on("tick",function(t){var i=20*t.alpha;e.nodes.forEach(function(t,e){"isAnswer"==t.type?t.x+=i:"hasAnswer"==t.type?t.x+=-i:"free"==t.type&&(t.y+=-i)});for(var o=d3.geom.quadtree(e.nodes),s=0,d=e.nodes.length;++s<d;)o.visit(a(e.nodes[s]));h.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),h.attr("cx",function(t){return t.x=Math.max(15,Math.min(u-15,t.x))}).attr("cy",function(t){return t.y=Math.max(15,Math.min(n-15,t.y))}),y.attr("d",function(t){return r(t)})})}